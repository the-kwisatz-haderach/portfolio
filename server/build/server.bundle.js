!function(e){var t={};function r(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(i,n,function(t){return e[t]}.bind(null,n));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=4)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"HttpException",{enumerable:!0,get:function(){return n.default}});var i,n=(i=r(12))&&i.__esModule?i:{default:i}},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("axios")},function(e,t,r){"use strict";var i;((i=r(5))&&i.__esModule?i:{default:i}).default.listen(process.env.PORT||8e3)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=u(r(2)),n=u(r(6)),s=u(r(7)),o=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=a();if(t&&t.has(e))return t.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var s=i?Object.getOwnPropertyDescriptor(e,n):null;s&&(s.get||s.set)?Object.defineProperty(r,n,s):r[n]=e[n]}r.default=e,t&&t.set(e,r);return r}(r(17));function a(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return a=function(){return e},e}function u(e){return e&&e.__esModule?e:{default:e}}const c=i.default.resolve("client","build");s.default.get("/auth",(e,t)=>{t.sendFile(i.default.resolve("client","public","auth.html"))}),s.default.get("/",(e,t)=>{t.sendFile(i.default.resolve("client","build","index.html"))});var l=new n.default(s.default,o.errorHandler,o.default,c);t.default=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i,n=(i=r(1))&&i.__esModule?i:{default:i};function s(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}t.default=class{constructor(e,t,r,i){s(this,"app",void 0),s(this,"router",void 0),s(this,"errorHandler",void 0),s(this,"middlewares",void 0),s(this,"publicFolder",void 0),this.app=(0,n.default)(),this.router=e,this.errorHandler=t,this.middlewares=r,this.publicFolder=i,r&&this.initializeMiddlewares(),e&&this.initializeRouter(),t&&this.initializeErrorHandler()}listen(e){this.app.listen(e,()=>console.log("Server is listening on port "+e))}initializeRouter(){this.app.use(this.router)}initializeErrorHandler(){this.app.use(this.errorHandler)}initializeMiddlewares(){this.publicFolder&&this.app.use(n.default.static(this.publicFolder)),this.middlewares.forEach(e=>{this.app.use(e)})}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=s(r(8)),n=s(r(9));function s(e){return e&&e.__esModule?e:{default:e}}var o=(0,i.default)(n.default);t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=(0,i.Router)();return e.forEach(({path:e,handler:r})=>{t.use(e,r)}),t};var i=r(1)},function(e,t,r){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=[{path:"/spotify",handler:((i=r(10))&&i.__esModule?i:{default:i}).default}];t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=a(r(11)),n=a(r(13)),s=a(r(15)),o=a(r(16));function a(e){return e&&e.__esModule?e:{default:e}}const u=new n.default({clientId:process.env.SPOTIFY_CLIENT_ID,clientSecret:process.env.SPOTIFY_CLIENT_SECRET,redirectUri:process.env.SPOTIFY_REDIRECT_URI},["playlist-read-collaborative","user-read-currently-playing","user-read-recently-played"]);var c=(0,i.default)(u,s.default,(0,o.default)(u),[process.env.SPOTIFY_USER_ID]);t.default=c},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i,n=(i=r(2))&&i.__esModule?i:{default:i},s=r(1),o=r(0);var a=function(t,r,i,a){const u=(0,s.Router)();return u.get("/auth",t.authorize.bind(t)),u.get("/auth/callback",t.authorizeCallback.bind(t),async(i,s,u)=>{if(a.length){const e=await r("",t.accessToken);if(!a.includes(e.id))return u(new o.HttpException(401,"User id blocked."))}s.redirect(n.default.resolve(e,"auth"))}),u.all("/api/*",i),u.get("/api/user",async(e,i,n)=>{try{const e=await r("",t.accessToken);i.json(e)}catch(e){n(e)}}),u.get("/api/recently-played",async(e,i,n)=>{try{const e=await r("/player/recently-played",t.accessToken);i.json(e)}catch(e){n(e)}}),u.get("/api/currently-playing",async(e,i,n)=>{try{const e=await r("/player/currently-playing",t.accessToken);i.json(e)}catch(e){n(e)}}),u.get("/api/playlists",async(e,i,n)=>{try{const e=await r("/playlists",t.accessToken);i.json(e)}catch(e){n(e)}}),u};t.default=a}).call(this,"/")},function(e,t,r){"use strict";function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;class n extends Error{constructor(e,t){super(t),i(this,"status",void 0),i(this,"message",void 0),this.status=e,this.message=t}}t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.SpotifyError=void 0;var i=o(r(14)),n=o(r(3)),s=r(0);function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class u extends s.HttpException{constructor(e,t){super(e,t),this.status=e,this.message=t}}t.SpotifyError=u;var c=class{constructor(e,t){a(this,"clientId",void 0),a(this,"clientSecret",void 0),a(this,"redirectUri",void 0),a(this,"encodedCredentials",void 0),a(this,"state",void 0),a(this,"refreshToken",void 0),a(this,"axiosTokenInstance",void 0),a(this,"scopes",void 0),a(this,"accessToken",void 0),a(this,"tokenIsValid",void 0),a(this,"grantedScopes",void 0),this.clientId=e.clientId,this.clientSecret=e.clientSecret,this.redirectUri=e.redirectUri,this.scopes=t,this.encodedCredentials=Buffer.from(this.clientId+":"+this.clientSecret).toString("base64"),this.axiosTokenInstance=n.default.create({baseURL:"https://accounts.spotify.com/api/token",headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:"Basic "+this.encodedCredentials}})}authorize(e,t){this.state=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15);const r=i.default.stringify({client_id:this.clientId,response_type:"code",redirect_uri:this.redirectUri,state:this.state,scope:this.scopes.join("%20")});t.redirect("https://accounts.spotify.com/authorize?"+r)}authorizeCallback(e,t,r){const{query:n}=e;if(n.state!==this.state&&r(new u(401,"Invalid state parameter provided.")),n.error&&r(n.error),n.code)return this.axiosTokenInstance.post("",i.default.stringify({grant_type:"authorization_code",code:n.code,redirect_uri:this.redirectUri})).then(({data:e})=>{setTimeout(()=>{this.tokenIsValid=!1},1e3*e.expires_in),this.tokenIsValid=!0,this.accessToken=e.access_token,this.refreshToken=e.refresh_token,this.grantedScopes=e.scope.split(" "),r()}).catch(e=>{r(new u(e.status,"Authorization failed."))})}refreshAccessToken(e){if(this.tokenIsValid&&e(),!this.tokenIsValid)return this.axiosTokenInstance.post("",i.default.stringify({grant_type:"refresh_token",refresh_token:this.refreshToken})).then(({data:t})=>{setTimeout(()=>{this.tokenIsValid=!1},1e3*t.expires_in),this.tokenIsValid=!0,this.accessToken=t.access_token,this.grantedScopes=t.scope.split(" "),e()}).catch(t=>{e(new u(t.status,"Refreshing token failed."))})}};t.default=c},function(e,t){e.exports=require("querystring")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return n.default.create({baseURL:"https://api.spotify.com/v1/me",headers:{Authorization:"Bearer "+t}}).get(e).then(({data:e})=>e).catch(e=>{throw new s.HttpException(e.status,e.message)})};var i,n=(i=r(3))&&i.__esModule?i:{default:i},s=r(0)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(0);var n=e=>async(t,r,n)=>{if(!e.accessToken)return n(new i.HttpException(401,"Access token missing."));if(!e.tokenIsValid)try{await e.refreshAccessToken(),n()}catch(e){n(e)}e.tokenIsValid&&n()};t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"errorHandler",{enumerable:!0,get:function(){return n.default}}),t.default=void 0;var i=s(r(18)),n=s(r(19));function s(e){return e&&e.__esModule?e:{default:e}}var o=[i.default.json()];t.default=o},function(e,t){e.exports=require("body-parser")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r,i){console.error(e),r.status(e.status||500).json(e.message||"Unknown server issue.")}}]);